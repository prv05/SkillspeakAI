<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Skill Speak AI - Profile</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dark">
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar-modern">
      <div class="sidebar-logo">SkillSpeak</div>
      <ul class="sidebar-menu">
        <li class="sidebar-item" onclick="window.location.href='dashboard.html'"><i class="fas fa-chart-pie"></i> <span>Dashboard</span></li>
        <li class="sidebar-item" onclick="window.location.href='chat.html'"><i class="fas fa-comments"></i> <span>Chat</span></li>
        <li class="sidebar-item active"><i class="fas fa-user"></i> <span>Profile</span></li>
        <li class="sidebar-item" onclick="window.location.href='feedback.html'"><i class="fas fa-comment-dots"></i> <span>Feedback</span></li>
        <li class="sidebar-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></li>
      </ul>
    </aside>
    <!-- Main Content -->
    <div class="profile-main-container">
      <h1 class="dashboard-title">Profile Settings</h1>
      <p class="dashboard-subtitle">Manage your account information and preferences</p>
      <div class="profile-cards-grid">
        <!-- Profile Picture + Account Settings Row -->
        <div class="profile-row-2col">
          <!-- Profile Picture -->
          <div class="profile-card profile-picture-card" style="min-width:340px;max-width:420px;width:100%;">
            <h2 class="profile-card-title"><i class="fas fa-image"></i> Profile Picture</h2>
            <div class="avatar-section" style="display:flex;flex-direction:column;align-items:center;justify-content:center;">
              <div id="userAvatarContainer" style="display:flex;align-items:center;justify-content:center;width:120px;height:120px;margin:0 auto;"></div>
              <div id="userEmailDisplay" style="margin-top:1.2rem;font-size:1.1rem;color:#bfc9e0;font-weight:500;"></div>
            </div>
          </div>
          <!-- Account Settings and Change Password Tabs -->
          <div class="profile-card">
            <div class="profile-tabs" style="display:flex;gap:1.5rem;margin-bottom:1.5rem;">
              <button id="accountTabBtn" class="tab-btn active" type="button">Account Settings</button>
              <button id="changePasswordTabBtn" class="tab-btn" type="button">Change Password</button>
            </div>
            <div id="accountSettingsTab">
              <form id="profileForm" class="profile-form">
                <div class="form-group">
                  <label for="name">Name</label>
                  <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input id="name" name="name" class="form-control profile-large-input profile-full-width" placeholder="Enter your name" readonly />
                  </div>
                </div>
                <div class="form-group">
                  <label for="email">Email</label>
                  <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input id="email" name="email" class="form-control profile-large-input profile-full-width" placeholder="Email" readonly />
                  </div>
                </div>
              </form>
            </div>
            <div id="changePasswordTab" style="display:none;">
              <form id="changePasswordForm" class="profile-form">
                <div class="form-group">
                  <label for="currentPassword">Current Password</label>
                  <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input id="currentPassword" name="currentPassword" type="password" class="form-control profile-large-input profile-full-width" placeholder="Current password" required />
                  </div>
                </div>
                <div class="form-group">
                  <label for="newPassword">New Password</label>
                  <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input id="newPassword" name="newPassword" type="password" class="form-control profile-large-input profile-full-width" placeholder="New password" required />
                  </div>
                </div>
                <div class="form-group">
                  <label for="confirmNewPassword">Confirm New Password</label>
                  <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input id="confirmNewPassword" name="confirmNewPassword" type="password" class="form-control profile-large-input profile-full-width" placeholder="Confirm new password" required />
                  </div>
                </div>
                <button type="submit" class="btn btn-secondary" style="margin-top:1.2rem;">Update Password</button>
              </form>
            </div>
          </div>
          <img id="photo" class="profile-photo" />
          <script src="script.js"></script>
          <script>
            function loadUserInfo() {
              const userName = localStorage.getItem("userName") || "Guest";
              // Show avatar with first letter of user name
              const firstLetter = userName.charAt(0).toUpperCase();
              document.getElementById("userAvatarContainer").innerHTML = `<span style='display:inline-flex;align-items:center;justify-content:center;width:100px;height:100px;border-radius:50%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;font-size:3rem;font-weight:bold;box-shadow:0 2px 12px 0 rgba(63,186,254,0.13);'>${firstLetter}</span>`;
              // Set name and email in form
              const nameField = document.getElementById("name");
              if (nameField) nameField.value = userName;
              const userEmail = localStorage.getItem("userEmail") || "";
              const emailField = document.getElementById("email");
              if (emailField) emailField.value = userEmail;
              // Show email below avatar
              const emailDisplay = document.getElementById("userEmailDisplay");
              if (emailDisplay) emailDisplay.textContent = userEmail;
            }
            document.addEventListener('DOMContentLoaded', loadUserInfo);

            // Handle form submissions
            document.querySelectorAll('.btn').forEach(btn => {
              btn.addEventListener('click', function() {
                if (this.textContent === 'Save Changes' || this.textContent === 'Update Password' || this.textContent === 'Save Preferences') {
                  alert('Settings saved successfully!');
                }
              });
            });
            // Avatar logic
            function triggerAvatarUpload() {
              document.getElementById('avatarUpload').click();
            }
            function removeAvatar() {
              var avatar = document.getElementById('profileAvatar');
              var defaultIcon = document.getElementById('defaultAvatarIcon');
              var removeBtn = document.getElementById('removeAvatarBtn');
              avatar.src = '';
              avatar.style.display = 'none';
              defaultIcon.style.display = 'block';
              removeBtn.style.display = 'none';
            }
            document.getElementById('avatarUpload').addEventListener('change', function(e) {
              var file = e.target.files[0];
              var avatar = document.getElementById('profileAvatar');
              var defaultIcon = document.getElementById('defaultAvatarIcon');
              var removeBtn = document.getElementById('removeAvatarBtn');
              if (file) {
                var reader = new FileReader();
                reader.onload = function(evt) {
                  avatar.src = evt.target.result;
                  avatar.style.display = 'block';
                  defaultIcon.style.display = 'none';
                  removeBtn.style.display = 'inline-block';
                };
                reader.readAsDataURL(file);
              }
            });
            // On page load, ensure default avatar and remove button are set correctly
            window.addEventListener('DOMContentLoaded', function() {
              var avatar = document.getElementById('profileAvatar');
              var defaultIcon = document.getElementById('defaultAvatarIcon');
              var removeBtn = document.getElementById('removeAvatarBtn');
              if (!avatar.src || avatar.src === window.location.href) {
                avatar.style.display = 'none';
                defaultIcon.style.display = 'block';
                removeBtn.style.display = 'none';
              } else {
                avatar.style.display = 'block';
                defaultIcon.style.display = 'none';
                removeBtn.style.display = 'inline-block';
              }
            });
          </script>
          <style>
            .tab-btn {
              background: transparent;
              border: none;
              color: #bfc9e0;
              padding: 0.75rem 1.5rem;
              border-radius: 8px;
              cursor: pointer;
              transition: all 0.3s ease;
              font-size: 1rem;
            }
            .tab-btn.active {
              background: var(--primary);
              color: white;
            }
          </style>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Tab switching logic
      const accountTabBtn = document.getElementById('accountTabBtn');
      const changePasswordTabBtn = document.getElementById('changePasswordTabBtn');
      const accountSettingsTab = document.getElementById('accountSettingsTab');
      const changePasswordTab = document.getElementById('changePasswordTab');
      if (accountTabBtn && changePasswordTabBtn && accountSettingsTab && changePasswordTab) {
        accountTabBtn.addEventListener('click', function() {
          accountTabBtn.classList.add('active');
          changePasswordTabBtn.classList.remove('active');
          accountSettingsTab.style.display = '';
          changePasswordTab.style.display = 'none';
        });
        changePasswordTabBtn.addEventListener('click', function() {
          changePasswordTabBtn.classList.add('active');
          accountTabBtn.classList.remove('active');
          accountSettingsTab.style.display = 'none';
          changePasswordTab.style.display = '';
        });
      }

      // Only fetch user data if logged in
      const token = localStorage.getItem('jwtToken');
      if (token) {
        fetch('http://localhost:5000/api/profile/me', {
          headers: { 'Authorization': 'Bearer ' + token }
        })
        .then(res => {
          if (!res.ok) throw new Error('Not authorized');
          return res.json();
        })
        .then(data => {
          // Populate profile fields with real user data
          if (data.name) document.getElementById('name').value = data.name;
          if (data.email) document.getElementById('email').value = data.email;
          if (data.email) document.getElementById('userEmailDisplay').textContent = data.email;
          // Optionally set avatar if available
          // if (data.photo_url) ...
        })
        .catch(err => {
          // Optionally show a message or leave fields blank
          document.getElementById('name').value = '';
          document.getElementById('email').value = '';
          document.getElementById('userEmailDisplay').textContent = '';
        });
      } else {
        // Not logged in: leave fields blank or show guest info
        document.getElementById('name').value = '';
        document.getElementById('email').value = '';
        document.getElementById('userEmailDisplay').textContent = '';
      }
    });
  </script>
</body>
</html> 