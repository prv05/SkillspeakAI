<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Skill Speak AI - Resources</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dark">
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar-modern">
      <div class="sidebar-logo">SkillSpeak</div>
      <ul class="sidebar-menu">
        <li class="sidebar-item" onclick="window.location.href='dashboard.html'"><i class="fas fa-chart-pie"></i> <span>Dashboard</span></li>
        <li class="sidebar-item" onclick="window.location.href='profile.html'"><i class="fas fa-user"></i> <span>Profile</span></li>
        <li class="sidebar-item active"><i class="fas fa-book"></i> <span>Resources</span></li>
        <li class="sidebar-item" onclick="window.location.href='feedback.html'"><i class="fas fa-comment-dots"></i> <span>Feedback</span></li>
        <li class="sidebar-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></li>
      </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-modern">
      <!-- Top Bar -->
      <div class="topbar">
        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Search resources..." />
        </div>
        <div class="topbar-actions">
          <div class="user-info" onclick="window.location.href='profile.html'" style="cursor: pointer;">
            <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User" class="user-avatar" />
            <span class="user-name">Alex</span>
          </div>
        </div>
      </div>

      <h1 class="dashboard-title">Learning Resources</h1>
      <p class="dashboard-subtitle">Upload and manage your study materials, notes, and learning resources</p>

      <!-- Single Tab Layout -->
      <div class="resources-main-container">
        <!-- Categories Section -->
        <div class="categories-section">
          <h2 class="section-title">Categories</h2>
          <div class="categories">
            <button class="category-btn active" onclick="filterResources('all')">All Resources</button>
            <button class="category-btn" onclick="filterResources('documents')">üìÑ Documents</button>
            <button class="category-btn" onclick="filterResources('videos')">üé• Videos</button>
            <button class="category-btn" onclick="filterResources('images')">üñºÔ∏è Images</button>
            <button class="category-btn" onclick="filterResources('presentations')">üìä Presentations</button>
            <button class="category-btn" onclick="filterResources('notes')">üìù Notes</button>
          </div>
        </div>

        <!-- Upload Section -->
        <div class="upload-section">
          <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">üìÅ</div>
            <div class="upload-text">Click to choose a file or drag and drop</div>
            <div class="upload-hint">Supports PDF, DOC, PPT, TXT, images, and videos (max 50MB)</div>
          </div>
          <input type="file" id="fileInput" class="file-input" multiple accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.rtf,.jpg,.jpeg,.png,.gif,.bmp,.webp,.mp4,.mov,.avi,.mkv,.webm,.wmv" style="display:none;">
          <div class="upload-actions">
            <button class="btn" onclick="document.getElementById('fileInput').click()">Choose File</button>
            <button class="btn btn-secondary" onclick="createFolder()">Create Folder</button>
          </div>
        </div>

        <!-- Breadcrumb (only shown when not in root) -->
        <div id="breadcrumbContainer" class="breadcrumb-container" style="display: none;">
          <div class="navigation-buttons">
            <button class="nav-btn" onclick="goHome()">
              <i class="fas fa-home"></i> Home
            </button>
            <button class="nav-btn" onclick="goBack()">
              <i class="fas fa-arrow-left"></i> Back
            </button>
            <span class="current-folder-name" id="currentFolderName"></span>
            <div class="folder-filter" id="folderFilterContainer">
              <span class="filter-label">Filter:</span>
              <select class="filter-select" onchange="changeFolderFilter(this.value)">
                <option value="all">All Files</option>
                <option value="images">üñºÔ∏è Images</option>
                <option value="videos">üé• Videos</option>
                <option value="documents">üìÑ Documents</option>
                <option value="presentations">üìä Presentations</option>
                <option value="notes">üìù Notes</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Resources Grid -->
        <div class="resources-grid" id="resourcesGrid">
          <!-- Dynamic content will be rendered here by JS -->
        </div>
      </div>

      <!-- File Preview Modal -->
      <div id="fileModal" class="file-modal" style="display:none;">
        <div class="file-modal-content" id="fileModalContent"></div>
        <span class="file-modal-close" onclick="closeFileModal()">&times;</span>
      </div>
    </main>
  </div>
  <script>
    // --- Resource Data Structure ---
    // Each resource: { id, name, type: 'file'|'folder', parentId, ext, date }
    let resources = JSON.parse(localStorage.getItem('resources')) || [
      { id: 'root', name: 'Root', type: 'folder', parentId: null }
    ];
    let currentFolderId = 'root';
    let currentFilter = 'all'; // Track current filter

    function saveResources() {
      localStorage.setItem('resources', JSON.stringify(resources));
    }

    function renderResources() {
      const grid = document.getElementById('resourcesGrid');
      const breadcrumbContainer = document.getElementById('breadcrumbContainer');
      grid.innerHTML = '';
      
      // Handle breadcrumb - only show when not in root
      if (currentFolderId !== 'root') {
        const currentFolder = resources.find(r => r.id === currentFolderId);
        const currentFolderNameElement = document.getElementById('currentFolderName');
        const filterSelect = document.querySelector('.filter-select');
        
        if (currentFolder) {
          currentFolderNameElement.textContent = currentFolder.name;
        }
        
        // Set the current filter in the dropdown
        if (filterSelect) {
          filterSelect.value = currentFilter;
        }
        
        breadcrumbContainer.style.display = 'block';
      } else {
        // Hide breadcrumb when in root
        breadcrumbContainer.style.display = 'none';
      }
      
      // List folders and files in current folder
      const children = resources.filter(r => r.parentId === currentFolderId && r.id !== 'root');
      
      // Apply category filter if not "all"
      let filteredChildren = children;
      if (currentFilter !== 'all') {
        filteredChildren = children.filter(res => {
          // Hide folders when filtering by specific categories
          if (res.type === 'folder') return false;
          
          // Filter files based on category
          switch (currentFilter) {
            case 'images':
              return ["jpg", "jpeg", "png", "gif", "bmp", "webp"].includes(res.ext);
            case 'videos':
              return ["mp4", "mov", "avi", "mkv", "webm", "wmv"].includes(res.ext);
            case 'documents':
              return ["pdf", "doc", "docx", "txt", "rtf"].includes(res.ext);
            case 'presentations':
              return ["ppt", "pptx"].includes(res.ext);
            case 'notes':
              return ["txt", "rtf"].includes(res.ext);
            default:
              return true;
          }
        });
      }
      
      if (filteredChildren.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'empty-state';
        
        if (currentFilter !== 'all') {
          // Show filter-specific message
          const filterNames = {
            'images': 'images',
            'videos': 'videos', 
            'documents': 'documents',
            'presentations': 'presentations',
            'notes': 'notes'
          };
          empty.innerHTML = `<div class="icon">üîç</div><h3>No ${filterNames[currentFilter]} found</h3><p>Try uploading some ${filterNames[currentFilter]} or check other categories</p>`;
        } else {
          // Show general empty state
          empty.innerHTML = `<div class="icon">üìö</div><h3>No resources here</h3><p>Add files or folders to get started</p>`;
        }
        
        grid.appendChild(empty);
      } else {
        filteredChildren.forEach(res => {
          const card = document.createElement('div');
          card.className = 'resource-card';
          if (["jpg","jpeg","png","gif","bmp","webp"].includes(res.ext) && res.preview) {
            card.innerHTML = `<div class='resource-header'><div class='resource-icon'><img src='${res.preview}' style='width:48px;height:48px;object-fit:cover;border-radius:8px;'/></div><div class='resource-info'><h3>${res.name}</h3><div class='resource-meta'>${res.ext.toUpperCase()} ‚Ä¢ ${res.size ? formatFileSize(res.size) : ''} ‚Ä¢ ${res.date || ''}</div></div><button class='btn btn-danger' style='margin-left:auto;' onclick='event.stopPropagation();deleteResource("${res.id}")'>üóëÔ∏è</button></div>`;
            card.style.cursor = 'pointer';
            card.onclick = function() { openFileModal(res); };
          } else if (res.type === 'folder') {
            card.innerHTML = `<div class=\"resource-header\"><div class=\"resource-icon\">üìÅ</div><div class=\"resource-info\"><h3>${res.name}</h3><div class=\"resource-meta\">Folder</div></div><button class='btn btn-danger' style='margin-left:auto;' onclick='event.stopPropagation();deleteFolder("${res.id}")'>üóëÔ∏è</button></div>`;
            card.style.cursor = 'pointer';
            card.onclick = function() { goToFolder(res.id); };
          } else {
            card.innerHTML = `<div class=\"resource-header\"><div class=\"resource-icon\">${getFileIcon(res.ext)}</div><div class=\"resource-info\"><h3>${res.name}</h3><div class=\"resource-meta\">${res.ext.toUpperCase()} ‚Ä¢ ${res.size ? formatFileSize(res.size) : ''} ‚Ä¢ ${res.date || ''}</div></div><button class='btn btn-danger' style='margin-left:auto;' onclick='event.stopPropagation();deleteResource("${res.id}")'>üóëÔ∏è</button></div>`;
            card.style.cursor = 'pointer';
            card.onclick = function() { openFileModal(res); };
          }
          grid.appendChild(card);
        });
      }
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function getFileIcon(ext) {
      if (["pdf"].includes(ext)) return "üìÑ";
      if (["doc","docx"].includes(ext)) return "üìù";
      if (["ppt","pptx"].includes(ext)) return "üìä";
      if (["txt","rtf"].includes(ext)) return "üìÑ";
      if (["jpg","jpeg","png","gif","bmp","webp"].includes(ext)) return "üñºÔ∏è";
      if (["mp4","mov","avi","mkv","webm","wmv"].includes(ext)) return "üé•";
      return "üìÅ";
    }

    function goToFolder(id) {
      currentFolderId = id;
      currentFilter = 'all'; // Reset filter when changing folders
      
      // Reset category button to "All Resources"
      document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector('.category-btn').classList.add('active'); // First button is "All Resources"
      
      renderResources();
    }

    function goHome() {
      currentFolderId = 'root';
      currentFilter = 'all'; // Reset filter when going home
      
      // Reset category button to "All Resources"
      document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector('.category-btn').classList.add('active'); // First button is "All Resources"
      
      renderResources();
    }
    
    function goBack() {
      const currentFolder = resources.find(r => r.id === currentFolderId);
      if (currentFolder && currentFolder.parentId) {
        currentFolderId = currentFolder.parentId;
        currentFilter = 'all'; // Reset filter when going back
      } else {
        // If no parent, go to home
        currentFolderId = 'root';
      }
      
      // Reset category button to "All Resources"
      document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector('.category-btn').classList.add('active'); // First button is "All Resources"
      
      renderResources();
    }

    function changeFolderFilter(filterValue) {
      currentFilter = filterValue;
      renderResources();
    }

    // --- Upload & Folder Logic ---
    function uploadFiles() {
      const fileInput = document.getElementById('fileInput');
      if (fileInput.files.length > 0) {
        Array.from(fileInput.files).forEach(file => {
          const ext = file.name.split('.').pop().toLowerCase();
          const reader = new FileReader();
          
          reader.onload = function(e) {
            const fileData = {
              id: 'f_' + Date.now() + Math.random(),
              name: file.name,
              type: 'file',
              parentId: currentFolderId,
              ext,
              date: new Date().toISOString().slice(0,10),
              size: file.size,
              preview: e.target.result
            };
            
            // Add specific handling for different file types
            if (["jpg", "jpeg", "png", "gif", "bmp", "webp"].includes(ext)) {
              // Images are already handled with preview
              fileData.preview = e.target.result;
            } else if (["pdf"].includes(ext)) {
              // PDF files - store as data URL for viewing
              fileData.preview = e.target.result;
            } else if (["mp4", "mov", "avi", "mkv", "webm", "wmv"].includes(ext)) {
              // Video files - store as data URL for viewing
              fileData.preview = e.target.result;
            } else if (["txt", "rtf"].includes(ext)) {
              // Text files - store as data URL for viewing
              fileData.preview = e.target.result;
            } else {
              // For other file types (doc, docx, ppt, pptx, etc.), store as data URL for download
              fileData.preview = e.target.result;
            }
            
            resources.push(fileData);
            saveResources();
            renderResources();
          };
          
          reader.readAsDataURL(file);
        });
        fileInput.value = '';
      } else {
        alert('Please select files to upload');
      }
    }
    function createFolder() {
      const folderName = prompt('Enter folder name:');
      if (folderName) {
        resources.push({
          id: 'fld_' + Date.now() + Math.random(),
          name: folderName,
          type: 'folder',
          parentId: currentFolderId
        });
        saveResources();
        renderResources();
      }
    }
    // Drag and drop functionality
    const uploadArea = document.querySelector('.upload-area');
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        Array.from(files).forEach(file => {
          const ext = file.name.split('.').pop().toLowerCase();
          const reader = new FileReader();
          
          reader.onload = function(e) {
            const fileData = {
              id: 'f_' + Date.now() + Math.random(),
              name: file.name,
              type: 'file',
              parentId: currentFolderId,
              ext,
              date: new Date().toISOString().slice(0,10),
              size: file.size,
              preview: e.target.result
            };
            
            // Add specific handling for different file types
            if (["jpg", "jpeg", "png", "gif", "bmp", "webp"].includes(ext)) {
              // Images are already handled with preview
              fileData.preview = e.target.result;
            } else if (["pdf"].includes(ext)) {
              // PDF files - store as data URL for viewing
              fileData.preview = e.target.result;
            } else if (["mp4", "mov", "avi", "mkv", "webm", "wmv"].includes(ext)) {
              // Video files - store as data URL for viewing
              fileData.preview = e.target.result;
            } else if (["txt", "rtf"].includes(ext)) {
              // Text files - store as data URL for viewing
              fileData.preview = e.target.result;
            } else {
              // For other file types (doc, docx, ppt, pptx, etc.), store as data URL for download
              fileData.preview = e.target.result;
            }
            
            resources.push(fileData);
            saveResources();
            renderResources();
          };
          
          reader.readAsDataURL(file);
        });
      }
    });
    // Category filtering (not folder navigation)
    function filterResources(category) {
      // Remove active class from all buttons
      document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
      // Add active class to clicked button
      event.target.classList.add('active');
      
      // Store the current filter
      currentFilter = category;
      
      // Re-render with filter applied
      renderResources();
    }
    // File input change handler
    document.getElementById('fileInput').addEventListener('change', function() {
      if (this.files.length > 0) {
        uploadFiles();
      }
    });
    // Initial render
    renderResources();
    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        alert('Logging out...');
        window.location.href = 'landing_page.html';
      }
    }
    function openFileModal(res) {
      const modal = document.getElementById('fileModal');
      const content = document.getElementById('fileModalContent');
      
      // Create file viewer structure
      let viewerHTML = `
        <div class="file-viewer">
          <div class="file-header">
            <div class="file-title">${res.name}</div>
            <div class="file-meta">${res.ext.toUpperCase()} ‚Ä¢ ${res.date || 'Unknown date'}</div>
          </div>
          <div class="file-body">
      `;
      
      // Handle different file types
      if (["jpg", "jpeg", "png", "gif", "bmp", "webp"].includes(res.ext) && res.preview) {
        // Image viewer
        viewerHTML += `
          <div class="image-viewer">
            <img src="${res.preview}" alt="${res.name}" />
          </div>
        `;
      } else if (["pdf"].includes(res.ext)) {
        // PDF viewer using PDF.js or browser's built-in viewer
        if (res.preview) {
          viewerHTML += `
            <div class="pdf-viewer">
              <iframe src="${res.preview}" title="${res.name}"></iframe>
            </div>
          `;
        } else {
          viewerHTML += `
            <div class="file-preview-placeholder">
              <div class="file-type-icon">üìÑ</div>
              <h3>${res.name}</h3>
              <p>PDF document - ${res.ext.toUpperCase()} format</p>
              <p>This PDF can be viewed in your browser or downloaded for offline viewing.</p>
              <a href="#" class="download-btn" onclick="downloadFile('${res.id}')">
                <i class="fas fa-download"></i> Download PDF
              </a>
            </div>
          `;
        }
      } else if (["doc", "docx"].includes(res.ext)) {
        // Word document viewer
        viewerHTML += `
          <div class="file-preview-placeholder">
            <div class="file-type-icon">üìù</div>
            <h3>${res.name}</h3>
            <p>Microsoft Word document - ${res.ext.toUpperCase()} format</p>
            <p>Word documents can be opened with Microsoft Word, Google Docs, or other compatible applications.</p>
            <a href="#" class="download-btn" onclick="downloadFile('${res.id}')">
              <i class="fas fa-download"></i> Download Document
            </a>
          </div>
        `;
      } else if (["ppt", "pptx"].includes(res.ext)) {
        // PowerPoint viewer
        viewerHTML += `
          <div class="file-preview-placeholder">
            <div class="file-type-icon">üìä</div>
            <h3>${res.name}</h3>
            <p>Microsoft PowerPoint presentation - ${res.ext.toUpperCase()} format</p>
            <p>PowerPoint files can be opened with Microsoft PowerPoint, Google Slides, or other compatible applications.</p>
            <a href="#" class="download-btn" onclick="downloadFile('${res.id}')">
              <i class="fas fa-download"></i> Download Presentation
            </a>
          </div>
        `;
      } else if (["mp4", "mov", "avi", "mkv", "webm", "wmv"].includes(res.ext)) {
        // Video viewer
        if (res.preview) {
          viewerHTML += `
            <div class="video-viewer">
              <video controls>
                <source src="${res.preview}" type="video/${res.ext}">
                Your browser does not support the video tag.
              </video>
            </div>
          `;
        } else {
          viewerHTML += `
            <div class="file-preview-placeholder">
              <div class="file-type-icon">üé•</div>
              <h3>${res.name}</h3>
              <p>Video file - ${res.ext.toUpperCase()} format</p>
              <p>This video can be played with your default video player or downloaded for offline viewing.</p>
              <a href="#" class="download-btn" onclick="downloadFile('${res.id}')">
                <i class="fas fa-download"></i> Download Video
              </a>
            </div>
          `;
        }
      } else if (["txt", "rtf"].includes(res.ext)) {
        // Text file viewer
        if (res.preview) {
          viewerHTML += `
            <div class="document-viewer">
              <iframe src="${res.preview}" title="${res.name}"></iframe>
            </div>
          `;
        } else {
          viewerHTML += `
            <div class="file-preview-placeholder">
              <div class="file-type-icon">üìÑ</div>
              <h3>${res.name}</h3>
              <p>Text document - ${res.ext.toUpperCase()} format</p>
              <p>Text files can be opened with any text editor or word processor.</p>
              <a href="#" class="download-btn" onclick="downloadFile('${res.id}')">
                <i class="fas fa-download"></i> Download Text File
              </a>
            </div>
          `;
        }
      } else {
        // Generic file viewer for unsupported types
        viewerHTML += `
          <div class="file-preview-placeholder">
            <div class="file-type-icon">${getFileIcon(res.ext)}</div>
            <h3>${res.name}</h3>
            <p>File type: ${res.ext.toUpperCase()}</p>
            <p>This file type is not directly viewable in the browser. Please download it to open with the appropriate application.</p>
            <a href="#" class="download-btn" onclick="downloadFile('${res.id}')">
              <i class="fas fa-download"></i> Download File
            </a>
          </div>
        `;
      }
      
      viewerHTML += `
          </div>
        </div>
      `;
      
      content.innerHTML = viewerHTML;
      modal.style.display = 'block';
    }
    
    function downloadFile(fileId) {
      const file = resources.find(r => r.id === fileId);
      if (file && file.preview) {
        // Create a temporary link to download the file
        const link = document.createElement('a');
        link.href = file.preview;
        link.download = file.name;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      } else {
        alert('File not available for download. Please try uploading the file again.');
      }
    }
    
    function closeFileModal() {
      document.getElementById('fileModal').style.display = 'none';
    }
    
    function deleteResource(id) {
      if (confirm('Are you sure you want to delete this file?')) {
        resources = resources.filter(r => r.id !== id);
        saveResources();
        renderResources();
      }
    }
    
    function deleteFolder(folderId) {
      const folder = resources.find(r => r.id === folderId);
      if (!folder) return;
      
      // Count items in folder for confirmation message
      const itemsInFolder = resources.filter(r => r.parentId === folderId);
      const itemCount = itemsInFolder.length;
      
      let confirmMessage = `Are you sure you want to delete the folder "${folder.name}"?`;
      if (itemCount > 0) {
        confirmMessage += `\n\nThis will also delete ${itemCount} item${itemCount === 1 ? '' : 's'} inside the folder.`;
      }
      
      if (confirm(confirmMessage)) {
        // Recursively delete all contents of the folder
        function deleteFolderContents(parentId) {
          const children = resources.filter(r => r.parentId === parentId);
          children.forEach(child => {
            if (child.type === 'folder') {
              // Recursively delete subfolder contents
              deleteFolderContents(child.id);
            }
            // Remove the child item
            resources = resources.filter(r => r.id !== child.id);
          });
        }
        
        // Delete folder contents first
        deleteFolderContents(folderId);
        
        // Delete the folder itself
        resources = resources.filter(r => r.id !== folderId);
        
        // If we're currently inside the deleted folder, go back to parent
        if (currentFolderId === folderId) {
          const parentFolder = resources.find(r => r.id === folder.parentId);
          currentFolderId = parentFolder ? parentFolder.id : 'root';
        }
        
        saveResources();
        renderResources();
      }
    }
  </script>
</body>
</html>